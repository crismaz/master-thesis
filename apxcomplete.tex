\section{APX-completeness for segments parallel to axis}
\label{section:segment_apx}

\subsection{Definition of  MAX-(3,3)-SAT problem}
Here we define MAXSAT problem.

\begin{tw}{
	\label{hastadtheorem}
	\textbf{\cite{hastad}}
	Assume NP $\not\subseteq$ $DTIME(2^{O(\log n \log \log n)})$.
	Then, there exists a constant $c > 0$, such that for
	$$\epsilon'(n) = \frac{c \log \log \log n}{\log \log n}$$ 
	fully satifiable 3-SAT formulas cannot be distinguished 
	in polynomial time from
	3-SAT formulas where no more than $(7/8+\epsilon'(n))n$ clauses
	can be satisfied in polynomial time.
}\end{tw}

\begin{lemma}{
	\label{apxconstruction}
	Given an instance of  MAX-(3,3)-SAT 
	with $n$ variables and optimal result $k$,
	we can construct an instance of axis-parallel segments in 2D,
	which optimal result (even with 1/2-extension) is exactly $15n - k$.
}\end{lemma}

\begin{tw}{
	\textbf{(axis-parallel segment set cover with 1/2-extension is APX-hard)}.	
	For sufficiently small $\epsilon > 0$,
	there does not exist an $(1+\epsilon)$-approximation scheme
	for unweighted geometric set cover
	with axis-parallel segments in 2D (even with 1/2-extension)
	(problem is APX-hard).
}\end{tw}

\paragraph{Proof.}
Take any $0 < \epsilon < 1/(15 \cdot 8)$.
Choose $n$ sufficiently large, so that $\epsilon'(n)$ from
Theorem \ref{hastadtheorem}
is not greater than $\epsilon$.

Let's assume that there exists an $(1+\epsilon)$-approximation scheme
for unweighted geometric set cover with axis-pararell segments in 2D.
We will construct an algorithm distinguishing instances of
MAX-(3,3)-SAT
in Theorem \ref{hastadtheorem}.
Take two instances to be distinguished and using
Lemma \ref{apxconstruction}
and name them satisfiable -- $S_1$ and unsatisfiable -- $S_2$.
Let's construct two instances of geometric set cover
and name them respectively $I_1$ and $I_2$.

Use $(1+\epsilon)$-approximation scheme for instances of geometric
set cover, let's name the result of this approximation
for an instance of problem $I$ as $approx(I)$.

From defintion of $S_1$ and $S_2$ we have:
$$OPT(S_1) = n$$
$$OPT(S_2) \le (\frac{7}{8} + \epsilon'(n))n$$

From Lemmma \ref{apxconstruction} we have:

$$OPT(I_1) = 14n$$
$$OPT(I_2) = 15n - (\frac{7}{8} + \epsilon'(n))n$$

Let's prove that $approx(I_2) > approx(I_1)$:

$$approx(I_2) \ge OPT(I_2) = 15n - (\frac{7}{8} + \epsilon'(n))n
	= 14n + (\frac{1}{8} - \epsilon'(n))n
	> 14n + (\frac{1}{8} - \epsilon)n > $$
$$	> 14n + (15\epsilon - \epsilon)n
	= 14n + (14\epsilon)n
	= 14n(1+\epsilon)
	= OPT(I_1)(1+\epsilon) \ge approx(I_1)$$ 



Therefore, by using out supposed $(1+\epsilon)$ approximation,
itâ€™s possible to distinguish $S_1$ from $S_2$, since
the approximation scheme will always return a smaller value
for $I_1$ than for $I_2$. This is a contradiction,
hence the approximation scheme cannot exist.

\subsection{Reduction construction}
\subsubsection{Definition of points and segments}

TODO: $y$ axis is increasing values downward on figures
(not upwards like in normal).

\paragraph{Points.}

Define points:
\begin{figure}[h]
\centering
\def\svgwidth{0.5\columnwidth}
\input{apx_choose_variable.pdf_tex}
\caption{\textbf{Choose variable value gadget.}
We denote set of points marked with black circle as $C\_variable_i$
and need to be covered (are part of set $\points$).
We denote set of red segments as $x^{false}_i$
and set of blue segments as $x^{true}_i$.}
\label{fig:apx_choose_variable}
\end{figure}

	$$L = 12n$$

\begin{center}
\begin{tabular}{ l l l l}
	$a_{i} = (-L, 4i)$ &
	$b_{i} = (-\frac{2}{3}L, 4i)$ & 
	$c_{i} = (-\frac{1}{3}L, 4i)$ & 
	$d_{i} = (-L, 4i+1)$ \\  
	$e_{i} = (-\frac{2}{3}L, 4i+1)$ & 
	$f_{i} = (-\frac{2}{3}L, 4i+2)$ &
	$g_i = (L, 4i)$ &
	$h_j = (L, 4i+2)$
\end{tabular}
\end{center}

TODO: Rephrase it


Assuming clause $C_i = x_i \lor y_i \lor z_i$,
function $idx(w)$ is returning index of the variable $w$,
function $neg(w)$ is returning whether variable $w$ is negated
in a clause.

\begin{center}
\begin{tabular}{ l l }
	$x_{i, 0} = (10i+1, 4\cdot idx(x_i) + 2\cdot neg(x_i))$ &
	$x_{i, 1} = (10i+1, 4n)$ \\
	$y_{i, 0} = (10i+2, 4\cdot idx(y_i) + 2\cdot neg(y_i))$ &
	$y_{i, 1} = (10i+2, 4n + 4)$ \\
	$z_{i, 0} = (10i+3, 4\cdot idx(z_i) + 2\cdot neg(z_i))$ &
	$z_{i, 1} = (10i+3, 4n + 6)$
\end{tabular}
\end{center}
	
	
	
\begin{figure}[h]
\centering
\def\svgwidth{0.5\columnwidth}
\input{apx_or_gadget.pdf_tex}
\caption{
\textbf{Or gadget.} We denote these point as $or\_gadget_{i, j}$. 
We denote set of red segments as $or^{false}_{i, j}$,
set of blue segments as $or^{true}_{i, j}$,
green and yellow segments as $or\_move\_variable_{i, j}$.
}
\label{fig:apx_or_gadget}
\end{figure}


\begin{figure}[h]
\centering
\def\svgwidth{0.8\columnwidth}
\input{apx_clause.pdf_tex}
\caption{\textbf{Clause gadget.}
We denote set of these points as $C\_clause_i$.
Every green rectangle is an or gadget.
$y$-coordinates of $x_{i, 0}$, $y_{i, 0}$ and $z_{i,0}$
depend on the values of variables in the $i$-th clause.
}
\label{fig:apx_clause}
\end{figure}
	$$vec_{i, j} = (10i + 3 + 3j, 4n + 2j)$$
	
	\begin{center}
\begin{tabular}{ l l l l}

	$l_0 = (0, 0)$ &
	$m_0 = (0, 1)$ &
	$n_0 = (0, 2)$ &
	$o_0 = (0, 3)$ \\
	$p_0 = (0, 4)$ &
	$q_0 = (1, 1)$ &
	$r_0 = (1, 3)$ &
	$s_0 = (2, 1)$ \\
	$t_0 = (2, 2)$ &
	$u_0 = (2, 3)$ &
	$v_0 = (3, 2)$ &
\end{tabular}
\end{center}
	
	
	
	Define 
	$\{ l_{i, j}, m_{i, j} \ldots v_{i, j} \}$
	as $\{l_0, m_0 \ldots v_0\}$ shifted by $vec_{i, j}$

Note that $v_{i, 0} = l_{i, 1}$ (see Figure~\ref{fig:apx_clause})

Let's define $$C\_variable_i =  \{a_i, b_i, c_i, d_i, e_i, f_i\}$$	
 
 $$move\_variable_i = 
 \{x_{i, j} : j \in \{0, 1\}\} \cup
 \{y_{i, j} : j \in \{0, 1\}\} \cup
 \{z_{i, j} : j \in \{0, 1\}\} 
 $$
 
 $$or\_gadget_{i, j} = 
 \{l_{i, j}, m_{i, j}, n_{i, j}, o_{i, j},
 p_{i, j}, q_{i, j}, r_{i, j}, s_{i, j}, t_{i, j}, u_{i, j} \}
 $$
 
 $$C\_clause_i = 
 move\_variable_i \cup or\_gadget_{i, 0}
 \cup or\_gadget_{i, 1} \cup \{v_{i, 1} \} 
 $$
 

Then we define:
$$\points := \bigcup_{1 \le i \le n} C\_variable_i \cup C\_clause_i $$


\paragraph{Segments.}

Let's define 

$$x^{true}_i =\{ (a_i, d_i), (b_i, f_i), (c_i, g_i)\}$$
$$x^{false}_i = \{(a_i, c_i), (d_i, e_i), (f_i, h_i)\}$$

$$P\_variable_i = x^{true}_i \cup x^{false}_i$$

$$or^{false}_{i, j} =
\{ (q_{i, j}, r_{i, j}), (s_{i, j}, u_{i, j})\}$$
$$or^{true}_{i, j} =
\{ (m_{i, j}, s_{i, j}), (o_{i, j}, u_{i, j}),
(t_{i, j}, v_{i, j}) \}$$

$$or\_move\_variable_{i, j} =
\{ (l_{i, j}, n_{i, j}), (n_{i, j}, p_{i, j})\}$$

\begin{eqnarray*}
P\_clause_i & = & \{ (x_{i, 0}, x_{i, 1}),
(y_{i, 0}, y_{i, 1}),
(z_{i, 0}, z_{i, 1}),
(x_{i, 1}, l_{i, 0}),
(y_{i, 1}, p_{i, 0}),
(z_{i, 1}, p_{i, 1}),
\} \cup \\
& & \cup \ or\_move\_variable_{i, 0} \cup or\_move\_variable_{i, 1} \cup \\
& & \cup \ or^{true}_{i, 0} \cup or^{true}_{i, 1} 
\cup or^{false}_{i, 0} \cup or^{false}_{i, 1}
\end{eqnarray*}

$$\sets := \bigcup_{1 \le i \le n} P\_variable_i \cup P\_clause_i $$

\begin{lemma}
\label{choose_variables_solution}
For any $1 \le i \le n$, points $C\_variable_i$
can be covered using 3 segments.
\end{lemma}

\paragraph{Proof.}
We can use set $x^{true}_i$ or $x^{false}_i$.

\begin{lemma}
\label{cover_or_true}
For any $1 \le i \le n, j \in \{0, 1\}$ and 
 $x \in \{l_{i, j}, p_{i, j}\}$ we can cover points in
$or\_gadget_{i, j} - \{ x\} \cup \{v_{i, j}\}$
with 4 segments.
\end{lemma}

\paragraph{Proof.}
We can do that using one segment from
$or\_move\_variable_{i, j}$
(chosen depending on the value of $x$)
and all segments from $or^{true}_{i, j}$.

\begin{lemma}
\label{cover_or_false}
For any $1 \le i \le n, j \in \{0, 1\}$, we can cover points in $or\_gadget_{i, j}$
with 4 segments.
\end{lemma}
\paragraph{Proof.}
We can do that using  $or\_move\_variable_{i, j}$
and $or^{false}_{i, j}$.


\begin{lemma}
\label{cover_clauses_solution_true}
For any $1 \le i \le n$ and $a \in \{ x_{i, 0}, y_{i, 0}, z_{i, 0}\}$,
points $C\_clause_i - \{a\}$ can be covered using 11 segments.
\end{lemma}

\paragraph{Proof.}
For $a = x_{i, 0}$ (analogous proof for $y_{i, 0}$):
First we use Lemma~\ref{cover_or_true} twice with excluded $x = l_{i, 0}$ and
$x = l_{i, 1} = v_{i, 0}$,
resulting with 8 segments $or^{true}_{i, 0} \cup or^{true}_{i, 1}$
which cover all required points apart from
$x_{i, 1}, y_{i, 0}, y_{i, 1}, z_{i, 0}, z_{i, 1}, l_{i, 0}$.
We cover those using additional 3 segments:
$\{ (x_{i, 1}, l_{i, 0}), (y_{i, 0}, y_{i, 1}),
(z_{i, 0}, z_{i, 1}) \}$

For $a = z_{0, i}$:
Using Lemma~\ref{cover_or_false} and Lemma~\ref{cover_or_true} with
$x = p_{i, 1}$,
resulting with 8 segments $or^{false}_{i, 0} \cup or^{true}_{i, 1}$
which cover all required points apart from
$x_{i, 0}, x_{i, 1}, y_{i, 0}, y_{i, 1}, z_{i, 1}, p_{i, 1}$.
We cover those using additional 3 segments:
$\{ (x_{i, 0}, x_{i, 1}), (y_{i, 0}, y_{i, 1}),
(z_{i, 1}, p_{i, 1}) \}$.

\begin{lemma}
\label{cover_clauses_solution_false}
 Points $C\_clause_i$ can be covered with 12 segments.
\end{lemma}

\paragraph{Proof.}
Using Lemma \ref{cover_or_false} twice we can
cover $or\_gadget_{i,0}$ and  $or\_gadget_{i,1}$
with 8 segments.

To cover the remaining points we additionally use:
$\{ (x_{i, 0}, x_{i, 1}), (y_{i, 0}, y_{i, 1}),
(z_{i, 0}, z_{i, 1}), (t_{i, 1}, v_{i, 1}) \}$

\begin{lemma}
\textbf{Robustness to 1/2-extensions}. For every segment $s \in \sets$,
$s$ and $s^{+\delta}$ cover the same points from $\points$.
\end{lemma}

\subsection{Proofs of construction Lemma \ref{apxconstruction}}
\begin{lemma}
	\label{construction_correctness}
	Given an instance of MAX-(3,3)-SAT of size $n$
	with optimal solution $k$.
	For instance of geometric cover, constructed
	according to Lemma~\ref{apxconstruction}, 
	there exists a solution of weight $15n - k$.
\end{lemma}
\paragraph{Proof.}
Let's name the assignments of the variables in MAX-(3,3)-SAT instance,
that achieve the optimal solution,
$y_1$,~$y_2$~$\ldots$~$y_n$,
Let's cover every variable gadget with solution described in
Lemma~\ref{choose_variables_solution},
in the $i$-th gadget choosing the set of segments responsible for the
value of $y_i$
(true -- $x_i^{true}$ or false -- $x_i^{false}$).

Cover every satisfied clause gadget with solution described in
Lemma~\ref{cover_clauses_solution_true}
and unsatisfied clause gadget with solution from
Lemma~\ref{cover_clauses_solution_false}.

This solution uses $3n + (11m + (m-k)) = 15n - k$ segments.


\begin{lemma}
\label{choose_variables_no_less}
For any $1 \le i \le n$, points $C\_variable_i$
can not be covered with less than 3 segments.
\end{lemma}

\paragraph{Proof.}
There is independent set $\{d_i, f_i, c_i\}$ of size 3, therefore it can
not be covered with less than 3 sets (segments).


\begin{lemma}
\label{choose_variables_both}
If both segments $\xTrueSegment$ and $\xFalseSegment$ are chosen, then
the remaining points from $C\_variable_i$ must be covered with 2 different
segments
\end{lemma}
\paragraph{Proof.}
There is independent set $\{a_i, e_i\}$ of size 2, therefore it can
not be covered with less than 2 sets (segments).


\begin{lemma}
\label{cover_clauses_segments_no_less}
For any $1 \le i \le n$,
points $C\_clause_i - \{ x_{i, 0}, y_{i, 0}, z_{i, 0}\}$
can not be covered using less than 11 segments.

All points $C\_clause_i$ can not be covered with less than 12 segments.
\end{lemma}


\paragraph{Proof of no cover with less than 12 segments.}
There is independent set of 12 points in $C\_clause_i \supseteq
\{ x_{i, 0}, y_{i, 0}, z_{i, 0}, l_{i, 0}, p_{i, 0}, q_{i, 0},
u_{i, 0}, v_{i, 0} = l_{i, 1}, p_{i, 1}, q_{i, 1}, u_{i, 1}, v_{i, 1} \}$.

\paragraph{Proof of no cover with less than 11 segments.}

We can choose disjoint sets $X, Y, Z$ such that
$X \cup Y \cup Z \subseteq C\_clause_i - \{x_{i, 0}, y_{i, 0}, z_{i, 0}\}$
and there are no segments covering points from different sets.
And we will prove lower bounds for each of these sets.

$$X = \{x_{i, 1}, y_{i, 1}, z_{i, 1}\}$$

Set $X$ is an indendent set, so it must be covered with 3 segments.

$$Y = or\_gadget_{i, 0} - \{l_{i, 0}, p_{i, 0}\}$$
$$Z = or\_gadget_{i, 1} - \{l_{i, 1}, p_{i, 1}\}$$


For both $Y$ and $Z$ we can check all of the subsets of 3 segments
with brutforce that none of them cover, so they have to be covered with
4 segments.

TODO: Funny fact, neither Y nor Z doesn't have independent set of size 4.

Therefore $C\_clause_i$ must be covered with at least 3 + 4 + 4 = 11 segments.

\begin{lemma}
	\label{construction_completness}
	Given an instance of MAX-(3,3)-SAT of size $n$,
	and solution of size $w$ to the instance of geometric cover,
	constructed	according to Lemma~\ref{apxconstruction},  
	there exists a solution to MAX-(3,3)-SAT of size at least $15n - w$.
\end{lemma}
\paragraph{Proof.}
Among the segments responsible for choosing the value of variable $x_i$,
we need to use at least 3 segments (Lemma~\ref{choose_variables_no_less}).
If we have chosen segments both $\xTrueSegment$ and $\xFalseSegment$,
then we have used at least 4 segments (Lemma~\ref{choose_variables_both})
from $P\_variable_i$.

If we chose at most one of the segments $\xTrueSegment$ and $\xFalseSegment$,
choose the corresponding variable value to the solution.
If we chose both segments,
choose the value that appears in most (at least 2) clauses.
If we have chosen none of the segments, choose any value.

To cover these segments we have used at least $3n + a$ segments,
where $a$ is the number of variables that we have chosen both
values for.

Among the segments responsible for the clause $C_i = x \lor y \lor z$
we need to use at least 11 segments
(Lemma~\ref{cover_clauses_segments_no_less})
and if we can cover it with 11 segments, then we have 
earlier chosen
segment responsible for correct value of variable $x$, $y$ or $z$.

So we have at least 11 segments for satisfied clauses
and at least 12 segments
for unsatisfied clauses, so we cover it with 
at least $11n + b$ segments, where $b$ is number of clauses
where none of the variables $x, y, z$ were chosen.
If the segment responsible for value of $x$ was taken,
but this variable is set to have different value,
then we have chosen segments for both $x$ and $\neg x$ for this variable,
so "we cheated" and this maybe clause is not met,
but we assigned the value for this $x_i$ that meets
the most clauses, so for each of such "cheated" variables,
at most one of the clauses isn't met.

So there are at most $a+b$ unsatsfied clauses in this instance,
so we have shown the assignment with at least  $n-(a+b)$ satisfied clauses.

$$w > 3n + a + 11n + b = 14n + a + b$$
$$15n - w  < 15n - 14 n - a - b = n - (a+b)$$

\subsubsection{Proof of Lemma \ref{apxconstruction}}
Given an instance of MAX-(3,3)-SAT of size $n$
with optimal result $k$.
Let's construct an instance of geometric cover,
constructed in aforementioned manner.

Given the Lemma~\ref{construction_correctness}, we know
the optimal solution for the constructed geometric cover is
at most $15n - k$ and since the $k$ is optimal solution
for MAX-(3,3)-SAT, then according to Lemma~\ref{construction_completness}
there doesn't exist a solution with cost lesser than $15n - k$.
